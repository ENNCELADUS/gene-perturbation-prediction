```
================================================================================
                        TransformerGenerator Architecture
                           (52,384,259 parameters)
================================================================================

INPUT
  │
  ├─── src (gene tokens)
  │         │
  │         ▼
  │    ┌─────────────────────────────────────────────────────────┐
  │    │                    GeneEncoder                          │
  │    │  ┌─────────────────────────────────────────────────┐    │
  │    │  │  Embedding(60697, 512, padding_idx=60694)       │    │
  │    │  │  [vocab_size=60697, embed_dim=512]              │    │
  │    │  └─────────────────────────────────────────────────┘    │
  │    │                         │                               │
  │    │                         ▼                               │
  │    │  ┌─────────────────────────────────────────────────┐    │
  │    │  │  LayerNorm(512)                                 │    │
  │    │  └─────────────────────────────────────────────────┘    │
  │    └─────────────────────────────────────────────────────────┘
  │                              │
  │                              ▼
  │                         gene_emb ──────────────────┐
  │                                                    │
  ├─── values (expression)                             │
  │         │                                          │
  │         ▼                                          │
  │    ┌─────────────────────────────────────────────────────────┐
  │    │               ContinuousValueEncoder                    │
  │    │  ┌─────────────────────────────────────────────────┐    │
  │    │  │  Linear(1 → 512)                                │    │
  │    │  └─────────────────────────────────────────────────┘    │
  │    │                         │                               │
  │    │                         ▼                               │
  │    │  ┌─────────────────────────────────────────────────┐    │
  │    │  │  ReLU()                                         │    │
  │    │  └─────────────────────────────────────────────────┘    │
  │    │                         │                               │
  │    │                         ▼                               │
  │    │  ┌─────────────────────────────────────────────────┐    │
  │    │  │  Linear(512 → 512)                              │    │
  │    │  └─────────────────────────────────────────────────┘    │
  │    │                         │                               │
  │    │                         ▼                               │
  │    │  ┌─────────────────────────────────────────────────┐    │
  │    │  │  LayerNorm(512)                                 │    │
  │    │  └─────────────────────────────────────────────────┘    │
  │    │                         │                               │
  │    │                         ▼                               │
  │    │  ┌─────────────────────────────────────────────────┐    │
  │    │  │  Dropout(p=0.2)                                 │    │
  │    │  └─────────────────────────────────────────────────┘    │
  │    └─────────────────────────────────────────────────────────┘
  │                              │                         │
  │                              ▼                         │
  │                         value_emb ─────────────────────┤
  │                                                        │
  └─── pert_flags (perturbation)                           │
            │                                              │
            ▼                                              │
       ┌─────────────────────────────────────────────────────────┐
       │                  PertEncoder                            │
       │  ┌─────────────────────────────────────────────────┐    │
       │  │  Embedding(3, 512, padding_idx=0)               │    │
       │  │  [0=pad, 1=ctrl, 2=pert]                        │    │
       │  └─────────────────────────────────────────────────┘    │
       └─────────────────────────────────────────────────────────┘
                             │                             │
                             ▼                             │
                         pert_emb ─────────────────────────┤
                                                           │
                                                           ▼
                                              ┌─────────────────────┐
                                              │   Element-wise ADD  │
                                              │ gene + value + pert │
                                              └─────────────────────┘
                                                           │
                                                           ▼
                                                      total_embs
                                                           │
================================================================================
                              TRANSFORMER ENCODER
                           (12 layers × 8 heads)
================================================================================
                                                           │
                                                           ▼
       ┌───────────────────────────────────────────────────────────────────────┐
       │                    TransformerEncoderLayer × 12                       │
       │  ┌─────────────────────────────────────────────────────────────────┐  │
       │  │                                                                 │  │
       │  │    ┌────────────────────────────────────────────────────────┐   │  │
       │  │    │          MultiheadAttention (8 heads)                  │   │  │
       │  │    │  ┌──────────────────────────────────────────────────┐  │   │  │
       │  │    │  │  Q, K, V projections: 512 → 512                  │  │   │  │
       │  │    │  │  Head dim: 512/8 = 64                            │  │   │  │
       │  │    │  │  out_proj: Linear(512 → 512)                     │  │   │  │
       │  │    │  └──────────────────────────────────────────────────┘  │   │  │
       │  │    └────────────────────────────────────────────────────────┘   │  │
       │  │                              │                                  │  │
       │  │                              ▼                                  │  │
       │  │    ┌────────────────────────────────────────────────────────┐   │  │
       │  │    │  Dropout1(p=0.2)                                       │   │  │
       │  │    └────────────────────────────────────────────────────────┘   │  │
       │  │                              │                                  │  │
       │  │                        ┌─────┴─────┐                            │  │
       │  │                        │  ADD (x)  │◄── residual                │  │
       │  │                        └─────┬─────┘                            │  │
       │  │                              │                                  │  │
       │  │                              ▼                                  │  │
       │  │    ┌────────────────────────────────────────────────────────┐   │  │
       │  │    │  LayerNorm1(512)                                       │   │  │
       │  │    └────────────────────────────────────────────────────────┘   │  │
       │  │                              │                                  │  │
       │  │                              ▼                                  │  │
       │  │    ┌────────────────────────────────────────────────────────┐   │  │
       │  │    │  FFN (Feed-Forward Network)                            │   │  │
       │  │    │  ┌──────────────────────────────────────────────────┐  │   │  │
       │  │    │  │  Linear1(512 → 512)                              │  │   │  │
       │  │    │  │  Dropout(p=0.2)                                  │  │   │  │
       │  │    │  │  Linear2(512 → 512)                              │  │   │  │
       │  │    │  └──────────────────────────────────────────────────┘  │   │  │
       │  │    └────────────────────────────────────────────────────────┘   │  │
       │  │                              │                                  │  │
       │  │                              ▼                                  │  │
       │  │    ┌────────────────────────────────────────────────────────┐   │  │
       │  │    │  Dropout2(p=0.2)                                       │   │  │
       │  │    └────────────────────────────────────────────────────────┘   │  │
       │  │                              │                                  │  │
       │  │                        ┌─────┴─────┐                            │  │
       │  │                        │  ADD (x)  │◄── residual                │  │
       │  │                        └─────┬─────┘                            │  │
       │  │                              │                                  │  │
       │  │                              ▼                                  │  │
       │  │    ┌────────────────────────────────────────────────────────┐   │  │
       │  │    │  LayerNorm2(512)                                       │   │  │
       │  │    └────────────────────────────────────────────────────────┘   │  │
       │  │                                                                 │  │
       │  └─────────────────────────────────────────────────────────────────┘  │
       │                              │                                        │
       │                    [Repeat × 12 layers]                               │
       │                              │                                        │
       └───────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
                              encoder_output
                                      │
          ┌───────────────────────────┼───────────────────────────┐
          │                           │                           │
          ▼                           ▼                           ▼
================================================================================
                                  DECODERS
================================================================================

┌─────────────────────────┐  ┌─────────────────────────┐  ┌─────────────────────────┐
│   AffineExprDecoder     │  │      ClsDecoder         │  │      MVCDecoder         │
│   (Expression Output)   │  │  (Classification)       │  │  (Multi-View Contrast)  │
├─────────────────────────┤  ├─────────────────────────┤  ├─────────────────────────┤
│                         │  │                         │  │                         │
│  ┌───────────────────┐  │  │  _decoder ModuleList:   │  │  ┌───────────────────┐  │
│  │  coeff_decoder    │  │  │                         │  │  │  gene2query       │  │
│  │  (ExprDecoder)    │  │  │  ┌───────────────────┐  │  │  │  Linear(512→512)  │  │
│  │                   │  │  │  │ Linear(512→512)   │  │  │  └───────────────────┘  │
│  │  fc: Sequential   │  │  │  └───────────────────┘  │  │           │             │
│  │  ├─Linear(512→512)│  │  │           │             │  │           ▼             │
│  │  ├─LeakyReLU(0.01)│  │  │           ▼             │  │  ┌───────────────────┐  │
│  │  ├─Linear(512→512)│  │  │  ┌───────────────────┐  │  │  │  query_activation │  │
│  │  ├─LeakyReLU(0.01)│  │  │  │ ReLU()            │  │  │  │  Sigmoid()        │  │
│  │  └─Linear(512→1)  │  │  │  └───────────────────┘  │  │  └───────────────────┘  │
│  │         │         │  │  │           │             │  │           │             │
│  │         ▼         │  │  │           ▼             │  │           ▼             │
│  │     coeff (α)     │  │  │  ┌───────────────────┐  │  │  ┌───────────────────┐  │
│  └───────────────────┘  │  │  │ LayerNorm(512)    │  │  │  │  W                │  │
│                         │  │  └───────────────────┘  │  │  │  Linear(512→512)  │  │
│  ┌───────────────────┐  │  │           │             │  │  │  (no bias)        │  │
│  │  bias_decoder     │  │  │           ▼             │  │  └───────────────────┘  │
│  │  (ExprDecoder)    │  │  │  ┌───────────────────┐  │  │           │             │
│  │                   │  │  │  │ Linear(512→512)   │  │  │           ▼             │
│  │  fc: Sequential   │  │  │  └───────────────────┘  │  │    Inner Product        │
│  │  ├─Linear(512→512)│  │  │           │             │  │    with gene_emb        │
│  │  ├─LeakyReLU(0.01)│  │  │           ▼             │  │                         │
│  │  ├─Linear(512→512)│  │  │  ┌───────────────────┐  │  │                         │
│  │  ├─LeakyReLU(0.01)│  │  │  │ ReLU()            │  │  │                         │
│  │  └─Linear(512→1)  │  │  │  └───────────────────┘  │  │                         │
│  │         │         │  │  │           │             │  │                         │
│  │         ▼         │  │  │           ▼             │  │                         │
│  │     bias (β)      │  │  │  ┌───────────────────┐  │  │                         │
│  └───────────────────┘  │  │  │ LayerNorm(512)    │  │  │                         │
│           │             │  │  └───────────────────┘  │  │                         │
│           ▼             │  │           │             │  │                         │
│  ┌───────────────────┐  │  │           ▼             │  │                         │
│  │ output = α*x + β  │  │  │  ┌───────────────────┐  │  │                         │
│  │ (Affine transform)│  │  │  │ out_layer         │  │  │                         │
│  └───────────────────┘  │  │  │ Linear(512→1)     │  │  │                         │
│           │             │  │  └───────────────────┘  │  │                         │
│           ▼             │  │           │             │  │                         │
│    Expression Pred      │  │           ▼             │  │                         │
│                         │  │    Class Logits         │  │                         │
└─────────────────────────┘  └─────────────────────────┘  └─────────────────────────┘

================================================================================
                              DIMENSION SUMMARY
================================================================================

  Component                    | Input Dim  | Output Dim | Parameters
  -----------------------------|------------|------------|------------
  GeneEncoder.embedding        | 60,697     | 512        | 31,076,864
  GeneEncoder.enc_norm         | 512        | 512        | 1,024
  ContinuousValueEncoder       | 1          | 512        | 263,680
  PertEncoder                  | 3          | 512        | 1,536
  TransformerEncoder (×12)     | 512        | 512        | 18,940,416
  AffineExprDecoder            | 512        | 1          | 1,576,962
  ClsDecoder                   | 512        | 1          | 526,849
  MVCDecoder                   | 512        | 512        | 524,288
  -----------------------------|------------|------------|------------
  TOTAL                        |            |            | 52,384,259

================================================================================
```