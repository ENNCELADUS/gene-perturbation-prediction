{
  "config": {
    "data": {
      "h5ad_path": "data/norman/perturb_processed.h5ad"
    },
    "split": {
      "min_cells_per_condition": 50,
      "query_fraction": 0.2,
      "min_query_cells": 10,
      "seed": 42,
      "output_path": "data/norman/splits/cell_split_seed42.json"
    },
    "track": "in_dist",
    "condition_split": {
      "train_ratio": 0.7,
      "val_ratio": 0.1,
      "test_ratio": 0.2,
      "seed": 42,
      "output_path": "data/norman/splits/condition_split_in_dist_seed42.json",
      "n_holdout_genes": 5
    },
    "model": {
      "encoder": "scgpt",
      "checkpoint": null,
      "finetune_checkpoint": "model/scgpt_finetune/best_head_only.pt",
      "finetune_apply_head": true,
      "freeze_encoder": true,
      "use_lora": false,
      "lora_rank": 8,
      "gene_alias_map_path": null,
      "raw_layer_key": "counts",
      "preprocess": true,
      "preprocess_normalize_total": "1e4",
      "preprocess_log1p": true,
      "preprocess_binning": 51,
      "preprocess_filter_gene_by_counts": 5,
      "preprocess_filter_cell_by_counts": false,
      "preprocess_subset_hvg": false,
      "preprocess_hvg_use_key": null,
      "preprocess_hvg_flavor": "seurat_v3",
      "preprocess_result_binned_key": "X_binned",
      "preprocess_result_normed_key": "X_normed",
      "preprocess_result_log1p_key": "X_log1p"
    },
    "library": {
      "type": "bootstrap",
      "n_prototypes": 30,
      "m_cells_per_prototype": 50,
      "seed": 42
    },
    "retrieval": {
      "metric": "cosine",
      "top_k": [
        1,
        5,
        8,
        10
      ]
    },
    "query": {
      "mode": "cell",
      "query_split": "test",
      "candidate_source": "all",
      "pseudo_bulk": {
        "cells_per_bulk": 50,
        "n_bulks": 1,
        "seed": 42
      },
      "pseudo_bulk_curve": {
        "enable": false,
        "cells_per_bulk_values": [
          10,
          25,
          50,
          100,
          200
        ],
        "n_bulks": 5,
        "seed": 42
      }
    },
    "evaluate": {
      "mask_perturbed": true,
      "mask_ablation": true
    },
    "confidence": {
      "enable": true,
      "method": "margin",
      "coverage_points": 20,
      "top_k_agreement": 1
    },
    "report": {
      "enable": false,
      "result_dirs": [],
      "output_dir": "results/reports",
      "report_name": "comparison_report"
    },
    "logging": {
      "output_dir": "results/",
      "experiment_name": "scgpt"
    }
  },
  "summary": {
    "h5ad_path": "data/norman/perturb_processed.h5ad",
    "loaded": true,
    "has_split": true,
    "n_cells": 91205,
    "n_genes": 5045,
    "n_control_cells": 7353,
    "n_perturbed_cells": 83852,
    "n_conditions": 282,
    "n_ref_cells": 67152,
    "n_query_cells": 16651,
    "n_valid_conditions": 282,
    "n_dropped_conditions": 1,
    "split_seed": 42
  },
  "metrics": {
    "exact_hit@1": 0.1349468500390367,
    "exact_hit@5": 0.35745600864812926,
    "exact_hit@8": 0.44483814785898745,
    "exact_hit@10": 0.4822533181190319,
    "mrr": 0.2295838564441051,
    "relevant_hit@1": 0.3666446459672092,
    "relevant_hit@5": 0.5427301663563749,
    "relevant_hit@8": 0.6007447000180169,
    "relevant_hit@10": 0.6281304426160591,
    "ndcg@1": 0.1349468500390367,
    "ndcg@5": 0.24859451101314284,
    "ndcg@8": 0.27802097585887375,
    "ndcg@10": 0.2890728002244319,
    "macro_hit@1": 0.1282558887819269,
    "macro_hit@5": 0.35047570456208543,
    "n_queries": 16651,
    "n_in_pool": 16651,
    "n_conditions": 282,
    "confidence_auc": 0.21085672522961596,
    "coverage_accuracy_curve": {
      "coverage": [
        0.05,
        0.1,
        0.15,
        0.2,
        0.25,
        0.3,
        0.35,
        0.39999999999999997,
        0.44999999999999996,
        0.49999999999999994,
        0.5499999999999999,
        0.6,
        0.65,
        0.7,
        0.75,
        0.7999999999999999,
        0.85,
        0.9,
        0.95,
        1.0
      ],
      "accuracy": [
        0.5805288461538461,
        0.4306306306306306,
        0.3528233880656788,
        0.3069069069069069,
        0.27222489187890436,
        0.24604604604604605,
        0.22618843315599793,
        0.21021021021021022,
        0.1994127068873465,
        0.19051051051051052,
        0.18213583751910897,
        0.1735735735735736,
        0.1673288367365795,
        0.16241956241956243,
        0.15759128763613067,
        0.1521021021021021,
        0.14745990249417085,
        0.14287620954287622,
        0.1389556201795423,
        0.1349468500390367
      ]
    }
  },
  "metrics_mask_off": {
    "exact_hit@1": 0.13578764038195903,
    "exact_hit@5": 0.3558945408684163,
    "exact_hit@8": 0.4405741396913098,
    "exact_hit@10": 0.4800312293555943,
    "mrr": 0.22973044661982261,
    "relevant_hit@1": 0.36484295237523273,
    "relevant_hit@5": 0.5424899405441115,
    "relevant_hit@8": 0.5984024983484475,
    "relevant_hit@10": 0.6278301603507297,
    "ndcg@1": 0.13578764038195903,
    "ndcg@5": 0.24838645099250647,
    "ndcg@8": 0.2769924721237999,
    "ndcg@10": 0.2886546639649751,
    "macro_hit@1": 0.12762660995860892,
    "macro_hit@5": 0.34760706064297286,
    "n_queries": 16651,
    "n_in_pool": 16651,
    "n_conditions": 282,
    "confidence_auc": 0.20116473359890827,
    "coverage_accuracy_curve": {
      "coverage": [
        0.05,
        0.1,
        0.15,
        0.2,
        0.25,
        0.3,
        0.35,
        0.39999999999999997,
        0.44999999999999996,
        0.49999999999999994,
        0.5499999999999999,
        0.6,
        0.65,
        0.7,
        0.75,
        0.7999999999999999,
        0.85,
        0.9,
        0.95,
        1.0
      ],
      "accuracy": [
        0.484375,
        0.39039039039039036,
        0.3315979175010012,
        0.29219219219219217,
        0.26309466602594905,
        0.24024024024024024,
        0.22052514158228934,
        0.20645645645645647,
        0.19300587293112653,
        0.1839039039039039,
        0.1741646647739681,
        0.16846846846846847,
        0.16307862884597615,
        0.15787215787215786,
        0.1530269058295964,
        0.14947447447447448,
        0.1459054617395605,
        0.14180847514180847,
        0.1380073334176255,
        0.13578764038195903
      ]
    }
  }
}